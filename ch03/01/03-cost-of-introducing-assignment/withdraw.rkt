#lang racket

;; è¿™é‡Œçš„ withdraw æ˜¯ç®€åŒ–ç‰ˆæœ¬ï¼Œå› ä¸ºæˆ‘ä»¬åªæ˜¯è¦è®¨è®ºå†…éƒ¨çŠ¶æ€æœ‰ä»€ä¹ˆé—®é¢˜
;; ä½¿ç”¨å†…éƒ¨çŠ¶æ€
(define (make-simplified-withdraw balance)
  (lambda (amount)
    (set! balance (- balance amount))
    balance))

(define W (make-simplified-withdraw 25))
(W 20)
(W 10)

;; ä¸ä½¿ç”¨å†…éƒ¨çŠ¶æ€çš„çº¯å‡½æ•°
(define (make-decrementer balance)
  (lambda (amount) (- balance amount)))

(define D (make-decrementer 25))
(D 20)
(D 10)

;; å¯¹äº make-decrementer
;; æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»£æ¢æ¨¡å‹å¦‚ä¸‹
;; (D 20) -> ((make-decrementer 25) 20) -> ((lambda (amount) (- 25 amount)) 20) -> 5
;;
;; ç„¶è€ŒåŒæ ·çš„æƒ…å†µå´æ— æ³•ç”¨åœ¨ make-simplified-withdraw
;; (W 20) -> ((make-simplified-withdraw 25) 20) -> ((lambda (amount) (set! balance (- 25 amount)) 25) 20)
;; -> (set! (balance (- 25 20))) 25) -> 25
;; è¿™æ˜¯ä¸ç¬¦åˆå®é™…æ„ä¹‰çš„(å› ä¸º set å·²ç»å°†åä¸€ä¸ª balance çš„å€¼æ”¹å˜äº†ï¼Œæ­¤å¤„ä¸èƒ½ç›´æ¥ä»£æ¢æˆ 25),
;; è¿™æ„å‘³ç€ä»£æ¢æ¨¡å‹æ— æ³•ç”¨åœ¨å…·æœ‰èµ‹å€¼æƒ…å†µçš„è¿‡ç¨‹ä¸­
;; åŒå¼•å·çš„å¼•å…¥ç ´åäº† "å€¼å¯ä»¥ç›´æ¥ç›¸äº’ä»£æ¢" (è½¬å˜ä¸ºåœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸‹å¯èƒ½æœ‰ä¸åŒçš„è¡¨ç°) çš„è®¾æƒ³ä¸€æ ·
;; è¿™ä¸¤è€…éƒ½æ‰“ç ´äº† â€œreferentially transparent" è¿™ä¸€æ€§è´¨

;; set! æˆ–è€…è¯´èµ‹å€¼çš„å¼•å…¥å¸¦æ¥äº†å¦ä¸€ä¸ªæ·±è¿œé—®é¢˜
;; æˆ‘ä»¬å¦‚ä½•ç¡®å®šåœ¨æ¨¡æ‹Ÿçš„ä¸–ç•Œä¸­çš„ä¸¤ä¸ª object æ˜¯ **ç›¸åŒ** çš„?
;; æœ¬èº«ç°å®;aä¸–ç•Œä¸­å¦‚ä½•ä¸¤ä¸ªä¸œè¥¿ "ç›¸åŒ" å°±æ˜¯ä¸ªå¾ˆæ¨¡ç³Šçš„æ¦‚å¿µäº†
;; æˆ‘ä»¬é€šå¸¸åªèƒ½ç”¨ â€œè§‚å¯Ÿæ³•" æ¥åˆ¤æ–­, ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬å¯¹è¢«è§‚å¯Ÿçš„ä¸¤ä¸ªä¸œè¥¿ä¸­çš„å…¶ä¸­ä¸€ä¸ªåšäº†æ”¹å˜ã€‚
;; åœ¨å¦å¤–ä¸€ä¸ªä¸œè¥¿ä¸Šä¹Ÿèƒ½çœ‹åˆ°ç›¸åŒçš„å˜åŒ–ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è®¤ä¸ºå®ƒä»¬æ˜¯ç›¸åŒçš„ã€‚
;; ç„¶è€Œè¿™åˆå¼•å…¥äº†ä¸€ä¸ªè¿‘ä¹å¥—å¨ƒçš„é—®é¢˜: æˆ‘ä»¬å¾—å…ˆæœ‰ä¸€ä¸ª å…ˆéªŒæ¦‚å¿µï¼ŒçŸ¥é“æˆ‘ä»¬è¦è§‚å¯Ÿçš„ä¸œè¥¿é¢„å…ˆè§‰å¾—æ˜¯ "åŒä¸€" çš„
;; æ‰èƒ½è¿›ä¸€æ­¥çš„å®šä¹‰å‘ç”Ÿåœ¨ â€åŒä¸€â€œ äº‹ç‰©ä¸Šçš„å˜åŒ–ï¼Œå•Šï¼Œphilosophy , å…ˆæœ‰é¸¡è¿˜æ˜¯å…ˆæœ‰ğŸ¥šï¼Ÿ

;; ä¸è¿‡ï¼Œå¯¹äº sameness å’Œ change çš„è®¨è®ºå»ºç«‹åœ¨ å¯¹è±¡æ˜¯å¯å˜çš„ çš„åŸºç¡€ä¸Š, å¦‚æœå¯¹è±¡ä¸å¯å˜
;; é‚£ä¹ˆå®Œå…¨å¯ä»¥å°†ä¸€ä¸ªå¤åˆå¯¹è±¡çœ‹ä½œå…¶ç‰‡æ®µç»„æˆçš„æ•´ä½“ã€‚æ¯”å¦‚, æˆ‘ä»¬é€šå¸¸ä¸ä¼šå°†ä¸€ä¸ª æœ‰ç†æ•° å¯¹è±¡çš„ denom / numer è®¾ç½®æˆå¯å˜çš„
;; é‚£ä¹ˆ â€œå˜åŒ–â€ è¿™ä»¶äº‹å°±ä¸ä¼šå‡ºç°åœ¨è¿™ä¸ªæœ‰ç†æ•°ç‰‡æ®µä¸Šï¼Œè‡ªç„¶ä¹Ÿå°±ä¸ç”¨å»è®¨è®ºå˜åŒ–åçš„æœ‰ç†æ•°æ˜¯ä¸æ˜¯åŒä¸€ä¸ªäº†

;; å¹¿æ³›é‡‡ç”¨ assignment çš„ç¨‹åºè®¾è®¡è¢«ç§°ä¸º å‘½ä»¤å¼ç¨‹åºè®¾è®¡
;; é™¤äº†ä¼šå¯¼è‡´ å¯è®¡ç®—æ¨¡å‹ (computational model) ä¸Šçš„å¤æ‚åº¦ä»¥å¤–ï¼Œå‘½ä»¤å¼ç¨‹åºè¿˜å¾ˆå®¹æ˜“å‡ºç°ä¸€äº›åœ¨å‡½æ•°æ˜¯ç¨‹åºä¸­ä¸ä¼šå‡ºç°çš„é”™è¯¯
;; ä¾‹å¦‚ ä¸‹é¢çš„ è¿­ä»£æ±‚é˜¶ä¹˜ç¨‹åº

(define (factorial n)
  (define (iter product counter)
    (if (> counter n)
        product
        (iter (* counter product) (+ counter 1))))
  (iter 1 1))

;; å¦‚ä¸‹æ˜¯å‘½ä»¤å¼é£æ ¼çš„æ±‚é˜¶ä¹˜
;; ä¼šå‘ç°ç¨‹åºçš„æ­£ç¡®æ€§å¼€å§‹Â·ä¾èµ–äºæˆ‘ä»¬çš„å‘½ä»¤é¡ºåºäº†ï¼Œå¦‚æœä¸¤ä¸ª set! è¯­å¥Â·é¢ å€’äº†å°±ä¸å¯¹äº†
;; ä¸€æ—¦æˆ‘ä»¬çš„ç¨‹åºæ¶‰åŠåˆ°å¹¶å‘ï¼Œé‚£ä¹ˆé—®é¢˜å¯èƒ½ä¼šæ›´åŠ å¤æ‚, å¹¶å‘ä¸­å„ä¸ªéƒ¨åˆ†çš„æ‰§è¡Œé¡ºåºå¯èƒ½ä¼šå˜å¾—çš„éå¸¸å¾®å¦™
(define (factorial-directive n)
  (let ((product 1)
        (counter 1))
    (define (iter)
      (if (> counter n)
          product
          (begin (set! product (* counter product))
                 (set! counter (+ counter 1))
                 (iter))))
    (iter)))

